##### 大文件下载示例

```php
//大文件下载
public function download_test(){
    $file = "test.mp4";

    if(!file_exists($file)){
        echo "file not exists,please check..";
        exit;
    }

    $chunkSize = 1024 * 1024; // 每次读取1M
    $handle = fopen($file, 'rb');
    header('Content-Type: application/octet-stream');	//流文件
    header('Content-Disposition: attachment; filename="'.basename($file).'"');		//attachment：方式为下载
    header('Content-Transfer-Encoding: binary');		//二进制文件，此方式可支持巨大文件的下载
    header('Accept-Ranges: bytes');		//范围请求，表示支持分块下载，续传
    header('Cache-Control: must-revalidate');	//缓存过期后，需向服务器校验。而no-cache为每次请求缓存都需要校验
    header('Pragma: public');	//公开缓存，共享式。而private为私有，即单用户缓存
    $i = 0;
    while (!feof($handle)) {
        $buffer = fread($handle, $chunkSize);
        echo $buffer;
        ob_flush();	//输出到缓冲
        flush();	//输出到客户端
        if ($i++ > 2000) { // 每2秒检查一次是否超时
            if (connection_aborted()) {
                break;
            }
            $i = 0;
        }
    }
    fclose($handle);
}
```

